<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بيانات المالكين | نظام إدارة التاكسي الذكي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --sidebar-bg: #0f172a; --accent: #fbbf24; }
        body { font-family: 'Tajawal', sans-serif; background-color: #f1f5f9; margin: 0; overflow-x: hidden; }
        
        /* القائمة الجانبية الثابتة */
        .sidebar { width: 280px; background: var(--sidebar-bg); height: 100vh; position: fixed; right: 0; top: 0; color: white; z-index: 1000; border-left: 1px solid rgba(255,255,255,0.05); }
        .main-content { margin-right: 280px; padding: 30px; transition: 0.3s; }
        
        .nav-link { display: flex; align-items: center; padding: 14px 24px; gap: 12px; color: #94a3b8; transition: 0.2s; font-weight: 700; border-right: 4px solid transparent; text-decoration: none; }
        .nav-link:hover, .nav-link.active { background: #1e293b; color: var(--accent); border-right-color: var(--accent); }

        /* البطاقة المزوقة (Modal) */
        .modal-container { display: none; position: fixed; inset: 0; z-index: 2000; align-items: center; justify-content: center; padding: 20px; background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(5px); }
        .modal-card { background: white; width: 100%; max-width: 600px; border-radius: 24px; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.3); border-top: 8px solid var(--accent); }
        
        .modal-header { padding: 20px 30px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 30px; display: grid; grid-template-columns: 1fr; gap: 15px; }

        /* الحقول */
        .field-group { display: flex; flex-direction: column; gap: 5px; }
        .field-label { font-size: 12px; font-weight: 900; color: #64748b; margin-right: 5px; }
        .field-input { background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 12px; font-weight: 700; color: #1e293b; text-align: center; outline: none; transition: 0.3s; }
        .field-input:focus { border-color: var(--accent); background: white; }

        @media (max-width: 1024px) {
            .sidebar { width: 80px; }
            .sidebar span, .sidebar h1, .sidebar p { display: none; }
            .main-content { margin-right: 80px; }
        }
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-content { margin-right: 0; padding: 15px; }
            .field-input { font-size: 1.4rem; padding: 16px; }
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="p-8 text-center border-b border-white/5">
            <h1 class="text-2xl font-black text-yellow-400">التاكسي الذكي</h1>
            <p class="text-[10px] text-slate-500 font-bold tracking-widest mt-1 uppercase">نظام الإدارة المتكامل</p>
        </div>
        <nav class="mt-4">
            <a href="cars.html" class="nav-link"><i class="fa-solid fa-car w-6"></i><span>بيانات السيارات</span></a>
            <a href="owners.html" class="nav-link active"><i class="fa-solid fa-user-tie w-6"></i><span>بيانات المالكين</span></a>
            <a href="drivers.html" class="nav-link"><i class="fa-solid fa-id-card w-6"></i><span>بيانات السائقين</span></a>
            <a href="custody.html" class="nav-link"><i class="fa-solid fa-key w-6"></i><span>سجل استلام السيارات</span></a>
            <a href="revenue.html" class="nav-link"><i class="fa-solid fa-coins w-6"></i><span>الإيرادات اليومية</span></a>
            <a href="expenses.html" class="nav-link"><i class="fa-solid fa-tools w-6"></i><span>المصاريف والتشغيل</span></a>
            <a href="payments.html" class="nav-link"><i class="fa-solid fa-money-bill-transfer w-6"></i><span>الدفعات المالية</span></a>
            <a href="reconciliation.html" class="nav-link"><i class="fa-solid fa-chart-pie w-6"></i><span>المطابقة المالية</span></a>
        </nav>
    </aside>

    <main class="main-content">
        <header class="flex justify-between items-center mb-8">
            <h2 class="text-3xl font-black text-slate-800">بيانات المالكين</h2>
            <button onclick="openModal()" class="bg-slate-900 text-white px-6 py-3 rounded-xl font-bold hover:bg-yellow-500 hover:text-slate-900 transition-all flex items-center gap-2 shadow-lg">
                <i class="fa-solid fa-user-plus"></i> إضافة مالك جديد
            </button>
        </header>

        <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
            <table class="w-full text-center">
                <thead class="bg-slate-50 text-slate-400 text-[11px] font-black uppercase tracking-widest border-b">
                    <tr>
                        <th class="p-5">اسم المالك</th>
                        <th class="p-5">رقم الهاتف</th>
                        <th class="p-5">العنوان</th>
                        <th class="p-5">الرقم الوطني</th>
                        <th class="p-5">العمليات</th>
                    </tr>
                </thead>
                <tbody id="ownersTableBody" class="font-bold text-slate-700 divide-y divide-slate-50 text-sm md:text-base">
                    </tbody>
            </table>
        </div>
    </main>

    <div id="ownerModal" class="modal-container">
        <div class="modal-card">
            <div class="modal-header">
                <h3 class="font-black text-xl text-slate-800">إضافة بيانات مالك</h3>
                <button onclick="closeModal()" class="text-2xl font-bold text-slate-400 hover:text-red-500">&times;</button>
            </div>
            <form id="ownerForm" class="modal-body">
                <div class="field-group">
                    <label class="field-label">اسم المالك الكامل</label>
                    <input type="text" name="name" required class="field-input" placeholder="أدخل الاسم">
                </div>
                <div class="field-group">
                    <label class="field-label">رقم الهاتف</label>
                    <input type="text" name="phone" required class="field-input" placeholder="07XXXXXXXX">
                </div>
                <div class="field-group">
                    <label class="field-label">العنوان السكني</label>
                    <input type="text" name="address" class="field-input" placeholder="المدينة / المنطقة">
                </div>
                <div class="field-group">
                    <label class="field-label">الرقم الوطني</label>
                    <input type="text" name="national_id" class="field-input" placeholder="الرقم الوطني المكون من 10 أرقام">
                </div>

                <button type="submit" class="bg-slate-900 text-yellow-400 font-black py-4 rounded-xl hover:bg-slate-800 transition-all text-lg mt-4 border-b-4 border-yellow-400">
                    تأكيد وحفظ البيانات
                </button>
            </form>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://tjntctaapsdynbywdfns.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_BJgdmxyFsCgzFDXh1Qn1CQ_cFRMsy2P';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function openModal() { document.getElementById('ownerModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('ownerModal').style.display = 'none'; document.getElementById('ownerForm').reset(); }

        async function loadOwners() {
            const { data, error } = await supabaseClient.from('owners').select('*').order('created_at', { ascending: false });
            if (data) {
                document.getElementById('ownersTableBody').innerHTML = data.map(owner => `
                    <tr class="hover:bg-slate-50 transition">
                        <td class="p-5">${owner.name}</td>
                        <td class="p-5">${owner.phone}</td>
                        <td class="p-5 text-slate-500">${owner.address || '-'}</td>
                        <td class="p-5 font-mono text-slate-500">${owner.national_id || '-'}</td>
                        <td class="p-5 flex justify-center gap-4">
                            <button class="text-slate-300 hover:text-blue-600 transition text-xl"><i class="fa-solid fa-pen-to-square"></i></button>
                            <button onclick="deleteOwner(${owner.id})" class="text-slate-300 hover:text-red-500 transition text-xl"><i class="fa-solid fa-trash-can"></i>
